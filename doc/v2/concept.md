# PomoBlock v2 コンセプト

## 1. 目的

予定に追われるのではなく、**自分の行動を "時間で制約する"** ことで、どんな働き方でも迷いなく着手し、割り込みや未完了タスクを吸収しながら、再計画と振り返りが継続して回る状態を作る。

制約には2つのレベルがある：

| レベル | 手段 | 役割 |
|--------|------|------|
| **マクロ制約** | ブロッキング | 行動領域（時間帯）を確保し、その時間に別の用事を入れない |
| **ミクロ制約** | タイマー | ブロック内の個々の行動を秒分単位の手順で律する |

ミクロ制約のバリエーション：

- **ポモドーロ**：25分集中5分休憩を繰り返すリズム制御
- **マイクロタイマー**：朝支度や日報など定型作業を「1ステップ1分」の手順レールで進める

---

## 2. 中核概念

### 2.1 ブロック（Block） マクロの行動領域

予定でもタスクリストでもなく、**「この時間帯はこのモードで動く」** という時間領域の宣言。

**ブロックの種類（例）：**

- 深い作業（コーディング、執筆など集中を要するもの）
- 雑務（メール返信、書類整理など短時間で片付く処理）
- 学習（読書、動画視聴など新しい知識を取り込む時間）
- 休憩移動家事

**制約強度：**

| 強度 | 意味 | 使いどころ |
|------|------|-----------|
| `draft` | 仮置き。自動生成された候補 | 今日のスケジュール初期値など |
| `soft` | 原則維持するが変更可 | 自動提案ブロック。予定変動時に自動で移動縮小される |
| `hard` | 動かさない固定枠 | 起床就寝ルーティン、会議前バッファ、食事など |

#### ブロック内メニュー（Block Contents）

1つのブロックには、以下の **複数の要素** を組み合わせて登録できる。

| 要素 | 内容 | 例 |
|------|------|-----|
| **レシピ（Recipe）** | 実行する手順セット（必須1つ） | 朝のマイクロタイマーレシピ |
| **タスクリスト** | このブロック中に片付けたいタスク（任意複数） | 「Aさんにメール返信」「請求書確認」 |
| **メモ** | ブロックに関する自由記述（任意） | 「先週の続きから」「集中モード：通知OFF」 |
| **目標時間の分割** | ブロック時間内のサブ区間設定（任意） | 「前半30分：インプット、後半30分：アウトプット」 |
| **チェックリスト** | ルーチン的な確認項目（任意） | 「ドキュメント保存」「Slack確認」 |

> **設計方針：** ブロックは「時間領域」であり、中身の要素は補助情報。タイマー（レシピ）が主役であることは変わらない。

---

### 2.2 ルーチン（Routine） 繰り返しの制約セット

「定期的に出現する行動」を **枠（Block）＋中身（Recipe/Timer）** としてセットで定義したもの。

**目的：** 毎回「何をどのくらいやるか」を考えなくて済むようにする。ルーチンを登録すれば、該当日時に Block と Recipe が自動で展開される。

**例：**

| ルーチン名 | 発生タイミング | Block | Recipe |
|-----------|--------------|-------|--------|
| 朝支度 | 毎朝 7:00 | 30分ブロック | 朝のマイクロタイマーレシピ |
| 週次レビュー | 毎週月曜 18:00 | 60分ブロック | 週次振り返りレシピ |
| 夕方片付け | 毎日 17:50 | 10分ブロック | 片付けマイクロタイマー |

---

### 2.3 レシピ（Recipe） ミクロの手順（タイマー列）

ブロック内で実行する **行動の手順書**。「何をするか（タスク）」ではなく「どの順番でどれだけ時間を使うか（手順）」を定義する。

レシピは複数の **ステップ** で構成される：

| ステップ種別 | 動作 | 例 |
|-------------|------|-----|
| **ポモドーロ** | 集中と休憩を交互に繰り返す | 25分集中  5分休憩  2セット |
| **マイクロ** | 1分単位で順番に進める | メール処理 1分10件、日報記入 1分6項目 |
| **自由枠** | タイマーは動かすが内容は固定しない | 深い作業 30分（何をするかはその時決める） |

**レシピの価値は「毎回同じ手順」にあり、着手前に何をするか迷う時間をゼロにすること。**
タスクリストは補助的に使うが、実行の主役はレシピ。

---

### 2.4 タイマー（Timer） 実行の制約エンジン

ブロック開始時に、選択されたレシピに沿ってタイマーが自動進行する。

#### 自動起動モード（Auto-Drive）

**時間になったらユーザー操作なしにタイマーが自動で開始する。**

| モード | 動作 | 向いている場面 |
|--------|------|--------------|
| `manual` | Start ボタンを押すまで待機 | 開始タイミングを自分で決めたい時 |
| `auto` | ブロック開始時刻になったら自動でタイマー開始。通知音のみ鳴らす | 毎朝の定型ルーティンなど |
| `auto-silent` | 通知なしで無音自動開始。画面を見れば進行中になっている | 邪魔されたくない集中ブロック |

自動起動時のフロー：

```
[ブロック開始時刻]  通知音  タイマー自動開始
                    ステップ終了  次のステップへ自動遷移（通知音）
                    全ステップ完了  終了通知  次のブロックへ
```

> **操作介入はいつでも可能：** 自動進行中でも `Pause / Interrupt / Skip` は常に操作できる。

**手動操作（5つ）：**

```
開始  次へ  一時停止  中断  再開
```

**ログ方針：**

- 実行ログはローカルDBに詳細記録（肥大化しないよう自動アーカイブ）
- 日次週次の集計結果のみ Google Calendar などに反映

---

## 3. ブロックの自動生成

ユーザーが「今日のスケジュールを作る」作業をなるべくゼロにする。アプリが毎朝、当日のブロック列を自動生成して提示する。

### 3.1 自動生成のインプット

| インプット | 内容 |
|-----------|------|
| **ルーチン定義** | 登録済みの繰り返しブロック（例：毎朝 7:00 朝支度） |
| **カレンダー同期** | Google Calendar 等の外部予定を取り込み、その前後にバッファブロックを挿入 |
| **ポリシー設定** | 「作業可能時間帯」「深い作業は午前優先」などのルール |
| **前日の未完了タスク** | 持ち越されたタスクを翌日の雑務ブロックに自動追加 |
| **実績データ** | 過去の開始時刻完了率集中時間の傾向から最適な配置を推定 |

### 3.2 自動生成のアウトプット

毎朝アプリを開くと（または通知で確認すると）、以下が揃っている状態にする：

1. **Today のタイムライン**  ブロック列が時刻順に並んでいる（`draft` 強度）
2. **各ブロックにレシピが紐づき済み**  開始ボタンを押すだけで動く状態
3. **未完了タスクが適切なブロックに割り振り済み**  手動で移動する必要がない

### 3.3 自動生成後のユーザー操作

生成結果に問題がなければ **何もしなくてよい**。必要な場合のみ微調整する：

- ブロックを長押しして時間種別を変更
- 不要なブロックを削除
- 緊急タスクを特定ブロックに追加

---

## 4. UX の基本思想

### 4.1 日常運用の主語を「計画」から「開始」へ

1日の操作を **3つの行為** に集約する：

1. **Today を確認する**  自動生成されたブロック列を見て、必要なら微調整する（5分以内）
2. **時間になったら自動で始まる（または Start を押す）**  レシピは自動選択済み
3. **Next / Pause / Interrupt で進める**  タイマーの指示に従うだけ

「今日何をやるか計画を入力する」ではなく、**時間になればアプリが動き出し、ユーザーはそれに乗るだけ** の体験にする。

---

### 4.2 画面を 4 つに絞る

| 画面 | 役割 | 主な要素 |
|------|------|---------|
| **Today** | 今日の全体像を確認微調整する | タイムライン（ブロック列）＋「次を始める」ボタン |
| **Now** | 実行中のタイマーを操作する | 現在のステップ名残り時間Next/Pause/Interrupt ボタン、ブロック内メニュー（タスクメモ） |
| **Routines** | ルーチンとレシピの設計管理 | ルーチン一覧ルーチン設計画面マイクロタイマー設計画面 |
| **Insights** | 実績の確認と振り返り | 日次週次の集中時間グラフ、完了率、未完了タスクの傾向 |

---

### 4.3 Routines 画面の構成

普段は触らない「設定の棚」だが、初期セットアップ時と定期メンテナンス時に使う。3つのサブ画面で構成する：

####  ルーチン設計画面（Routine Editor）

繰り返しブロックを作成編集する画面。

| 設定項目 | 内容 | 例 |
|---------|------|-----|
| ルーチン名 | 識別用の名前 | 「朝支度」 |
| 発生タイミング | 曜日時刻繰り返し頻度 | 毎日 7:00 |
| ブロック種別 | 割り当てるブロックのモード | ルーティン作業 |
| ブロック長 | 確保する時間（分） | 30分 |
| 紐づけるレシピ | 自動で選択されるレシピ | 朝のマイクロタイマー |
| 制約強度 | draft / soft / hard | hard（毎朝必ず実行） |

####  マイクロタイマー設計画面（Micro Recipe Editor）

1分単位で手順を定義するマイクロレシピを作成編集する画面。

| 設定項目 | 内容 | 例 |
|---------|------|-----|
| レシピ名 | 識別用の名前 | 「朝支度レシピ」 |
| ステップ一覧 | 順番ステップ名時間（分）を並べる | 1: 着替え 3分 / 2: 洗顔 5分 / 3: 朝食 15分 / 4: 出発準備 7分 |
| ステップ間の通知 | 次のステップ開始時に音振動で知らせる | ON |
| オーバーラン対応 | 時間を超過した場合の動作 | 通知して次へ自動遷移 / 待機 |

ステップは **ドラッグ＆ドロップで並び替え**、**＋ボタンで追加**、**長押しで削除**できる。

####  ポモドーロ設計画面（Pomodoro Recipe Editor）

集中休憩のサイクルを定義する画面。

| 設定項目 | 内容 | デフォルト |
|---------|------|----------|
| 集中時間 | 1ポモドーロの集中時間（分） | 25分 |
| 短休憩 | 1ポモドーロ後の休憩時間（分） | 5分 |
| 長休憩 | N回後に入る長めの休憩（分） | 4回ごとに15分 |
| セット数 | 1レシピで繰り返す回数 | 2セット |
| 自動開始 | 集中休憩の自動遷移 | ON |

---

### 4.4 迷いを減らす原則

- ブロック開始時、**レシピは自動で選択済み** にする（ブロック種別に紐づけ）
- ユーザーが手動選択する場合も、**候補はそのブロック種別に対応する数個のみ** に絞る
- 選択肢が多い状態を設計上作らない

---

## 5. 働き方非依存の設計

働き方の違い（フルタイム勤務、フリーランス、育児中など）は、すべて **「時間の制約パターン」** として表現できる。

### 5.1 ポリシー（Policy）による差し替え

- 「何時から何時が作業可能か」「深い作業は午前だけにする」などのルールを **最小パラメータのポリシー** として定義する
- 働き方が変わったら、ポリシーを差し替えるだけでブロック生成ルールが変わる

### 5.2 パラメータの推定と上書き

| 種別 | 意味 | 例 |
|------|------|-----|
| `observed` | 過去の実績から自動推定した値 | 「平均的に9時に作業開始している」 |
| `estimated` | アプリが初期値として推定した値 | 「深い作業は2時間が目安」 |
| `soft` 上書き | ユーザーが設定したが変更可 | 「今週は11時スタートで」 |
| `hard` 上書き | ユーザーが固定した設定 | 「毎朝8時のブロックは絶対に動かさない」 |
| `temporary` 上書き | 今日だけ有効な例外 | 「今日は外出があるので午後のブロックを短縮」 |

**設定地獄を避ける原則：** デフォルトは自動推定値を使い、ユーザーは「気になる項目だけ上書き」できれば十分。